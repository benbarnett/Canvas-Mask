/*************************************************
Canvas Mask Utility v0.2
Author: www.benbarnett.net || @benpbarnett

Copyright (c) 2011 Ben Barnett
Licensed under the MIT license
http://www.opensource.org/licenses/mit-license.php
**************************************************/
function applyCanvasMask(a,h,c,b,j){if(!document.createElement("canvas").getContext&&!j)return a;if(!document.createElement("canvas").getContext&&j)return a.src;var k=document.createElement("canvas"),d=k.getContext("2d"),e=document.createElement("canvas"),m=e.getContext("2d"),f=null,g=null,l=null;k.width=c;k.height=2*b;e.width=c;e.height=b;d.drawImage(a,0,0);d.drawImage(h,0,b);f=d.getImageData(0,0,c,b);g=f.data;l=d.getImageData(0,b,c,b).data;a=3;for(h=g.length;a<h;a+=4)g[a]>l[a]&&(g[a]=l[a]);return j?
(m.clearRect(0,0,c,b),m.putImageData(f,0,0),e.toDataURL()):f};